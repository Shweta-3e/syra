<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ThirdEye</title>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.css">
</head>
<body>
    <div class="container">
        <br />
        <div class="row">
            <div class='col-sm-3'>
                <div class="form-group">
                    <div id="filterDate2">
                        <div class="input-group date" data-date-format="mm-dd-yyyy" style="width:450px;">
                            <input type="text" id="startdate" class="form-control" placeholder="Start Date" style="margin-right:20px;">
                            <div class="input-group-addon">
                                <span class="glyphicon glyphicon-th"></span>
                            </div>
                            <input type="text" id="enddate" class="form-control" placeholder="End Date">
                            <div class="input-group-addon">
                                <span class="glyphicon glyphicon-th"></span>
                            </div>
                            <button class="btn btn-success" style="margin-left:25px;" onclick="showDate()">Submit</button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function showDate() {
            var startdate = document.getElementById("startdate").value;
            var enddate = document.getElementById("enddate").value;
            $.ajax({
                type: "POST",
                url: "/Customer/GetLogs?startdt=" + startdate + '&enddt=' + enddate,
                data: '{ }',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response != null) {
                        console.log(response);
                        //drawGlobe();
                        //drawGraticule();
                        //enableRotation();
                    } else {
                        alert("Something went wrong");
                    }
                },
                failure: function (response) {
                    alert(response.responseText);
                },
                error: function (response) {
                    alert(response.responseText);
                }
            });
        }
    </script>
    <svg></svg>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.input-group date').datetimepicker({
                format: 'dd/mm/yyyy'
            });
        });
        const width = 960;
        const height = 500;
        const config = {
            speed: 0.010,
            verticalTilt: -30,
            horizontalTilt: 0
        }
        let locations = [];
        const svg = d3.select('svg').attr('width', width).attr('height', height);
        const markerGroup = svg.append('g');
        const projection = d3.geoOrthographic();
        const initialScale = projection.scale();
        const path = d3.geoPath().projection(projection);
        const center = [width / 2, height / 2];


        drawGlobe();
        drawGraticule();
        enableRotation();

        function drawGlobe() {
            d3.queue()
                .defer(d3.json, 'https://gist.githubusercontent.com/mbostock/4090846/raw/d534aba169207548a8a3d670c9c2cc719ff05c47/world-110m.json')
                .defer(d3.json, '/AppScript/Analytics/Template/locations.json')
                .await((error, worldData, locationData) => {
                    svg.selectAll(".segment")
                        .data(topojson.feature(worldData, worldData.objects.countries).features)
                        .enter().append("path")
                        .attr("class", "segment")
                        .attr("d", path)
                        .style("stroke", "#888")
                        .style("stroke-width", "1px")
                        .style("fill", (d, i) => '#e5e5e5')
                        .style("opacity", ".6");
                    locations = locationData;
                    drawMarkers();
                });
        }

        function drawGraticule() {
            const graticule = d3.geoGraticule()
                .step([10, 10]);

            svg.append("path")
                .datum(graticule)
                .attr("class", "graticule")
                .attr("d", path)
                .style("fill", "#fff")
                .style("stroke", "#ccc");
        }

        function enableRotation() {
            d3.timer(function (elapsed) {
                projection.rotate([config.speed * elapsed - 120, config.verticalTilt, config.horizontalTilt]);
                svg.selectAll("path").attr("d", path);
                drawMarkers();
            });
        }

        function drawMarkers() {
            const markers = markerGroup.selectAll('circle')
                .data(locations);
            markers
                .enter()
                .append('circle')
                .merge(markers)
                .attr('cx', d => projection([d.longitude, d.latitude])[0])
                .attr('cy', d => projection([d.longitude, d.latitude])[1])
                .attr('fill', d => {
                    const coordinate = [d.longitude, d.latitude];
                    gdistance = d3.geoDistance(coordinate, projection.invert(center));
                    return gdistance > 1.57 ? 'none' : 'steelblue';
                })
                .attr('r', 7);

            markerGroup.each(function () {
                this.parentNode.appendChild(this);
            });
        }
    </script>
</body>
</html>
